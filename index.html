<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cash Habit</title>
  <meta name="theme-color" content="#111" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
  <style>
    :root{ --bg:#111; --panel:#171717; --text:#eee; --muted:#9aa0a6; --border:#242424; --pos:#00c853; --neg:#ff5252; }
    html,body{height:100%}
    body{ margin:0; background:var(--bg); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,sans-serif; -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility; }
    .wrap{max-width:980px;margin:18px auto;padding:16px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px}
    h1{font-size:18px;margin:0 0 10px 0}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .balance{ flex:1; min-width:260px; background:#121212;border:1px solid var(--border);border-radius:14px;padding:14px; }
    .balance .label{font-size:12px;color:var(--muted)}
    .balance .value{font-size:32px;font-weight:800;letter-spacing:.4px}
    .sub{font-size:12px;color:var(--muted);margin-top:4px}
    .actions{display:flex;gap:10px;align-items:center}
    .btn{appearance:none;-webkit-appearance:none;cursor:pointer;border:1px solid var(--border);background:#141414;color:#fff;padding:10px 14px;border-radius:12px;font-weight:600}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:#142016}
    .btn.danger{background:#1f1414}
    .canvas-wrap{background:#0e0e0e;border:1px solid var(--border);border-radius:16px;padding:10px}
    canvas{display:block;width:100%}
    .sheet{ position:fixed;left:0;right:0;bottom:-100%;background:#131317;border-top:1px solid var(--border); border-top-left-radius:16px;border-top-right-radius:16px;padding:14px 16px 20px;z-index:50;transition:bottom .25s ease;}
    .sheet.open{bottom:0}
    .sheet .grab{width:44px;height:4px;border-radius:999px;background:#2a2a2f;margin:4px auto 12px}
    .sheet h2{font-size:16px;margin:0 0 8px 0}
    .tabbar{display:flex;gap:8px;margin-bottom:8px}
    .tab{flex:1;text-align:center;padding:8px 10px;border-radius:10px;cursor:pointer;border:1px solid var(--border);background:#0f0f12;font-weight:600}
    .tab.active{background:#15151a}
    .list{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .item{border:1px solid var(--border);border-radius:12px;padding:10px;cursor:pointer;background:#0f0f12;display:flex;align-items:center;justify-content:space-between;gap:8px}
    .item .name{font-size:14px}
    .item .meta{font-size:12px;color:var(--muted)}
    .item.habit{color:var(--pos)} .item.vice{color:var(--neg)}
    .sheet .footer{display:flex;gap:10px;margin-top:12px} .btn.secondary{background:#121214}
    .manage .list .item button{padding:6px 10px;border-radius:8px}
    .manage h3{font-size:14px;margin:6px 0}
    .settings .row2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .input{display:flex;flex-direction:column;gap:6px}
    .input input{background:#121212;border:1px solid #242424;border-radius:10px;color:#fff;padding:10px}
    .input label{font-size:12px;color:#9aa0a6}
    @media (max-width:560px){ .list{grid-template-columns:1fr} .settings .row2{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" style="margin-bottom:16px">
      <div class="header">
        <div class="balance">
          <div class="label">Cash Balance</div>
          <div class="value" id="cashBalance">$0</div>
          <div class="sub">
            <span id="todayDelta">Today: $0</span> •
            <span id="pointsToday">Points today: 0</span>
          </div>
        </div>
        <div class="actions">
          <button class="btn primary" id="btnUp">▲ Up</button>
          <button class="btn danger"  id="btnDown">▼ Down</button>
          <button class="btn" id="btnUndo">⟲ Undo</button>
          <button class="btn" id="btnExport">⇩ Export</button>
          <button class="btn" id="btnManage">⚙︎ Manage</button>
          <button class="btn" id="btnSettings">⚙︎ Settings</button>
        </div>
      </div>
    </div>
    <div class="card">
      <h1>Cash Over Time</h1>
      <div class="canvas-wrap">
        <canvas id="trendChart" height="320"></canvas>
      </div>
    </div>
  </div>

  <div class="sheet" id="selectorSheet" aria-hidden="true">
    <div class="grab"></div>
    <h2 id="sheetTitle">Select Habit or Vice</h2>
    <div class="tabbar">
      <div class="tab active" id="tabHabits">Habits</div>
      <div class="tab" id="tabVices">Vices</div>
    </div>
    <div class="list" id="listHabits"></div>
    <div class="list" id="listVices" style="display:none"></div>
    <div class="footer">
      <button class="btn secondary" id="sheetCancel">Cancel</button>
      <button class="btn primary" id="sheetApply">Apply</button>
    </div>
  </div>

  <div class="sheet manage" id="manageSheet" aria-hidden="true">
    <div class="grab"></div>
    <h2>Manage Habits & Vices</h2>
    <form id="itemForm" class="row" style="margin-top:8px">
      <div class="input"><label for="itemName">Name</label><input id="itemName" type="text" placeholder="e.g., Cold Shower" required></div>
      <div class="input"><label for="itemType">Type</label><select id="itemType" required><option value="habit">Habit</option><option value="vice">Vice</option></select></div>
      <div class="input"><label for="itemCash">Cash (±)</label><input id="itemCash" type="number" step="1" value="1" required></div>
      <div class="input"><label for="itemPoints">Points (±)</label><input id="itemPoints" type="number" step="1" value="1" required></div>
      <div style="display:flex;align-items:flex-end;gap:10px">
        <button class="btn primary" type="submit" id="btnSaveItem">Save</button>
        <button class="btn" type="button" id="btnNewItem">New</button>
        <button class="btn secondary" type="button" id="btnCloseManage">Close</button>
      </div>
    </form>
    <div style="height:10px"></div>
    <h3>Items</h3>
    <div id="catalogList" class="list"></div>
  </div>

  <div class="sheet settings" id="settingsSheet" aria-hidden="true">
    <div class="grab"></div>
    <h2>Settings</h2>
    <div class="row2 row" style="margin-top:8px">
      <div class="input"><label for="currencySymbol">Currency Symbol</label><input id="currencySymbol" type="text" value="$" maxlength="3"></div>
      <div class="input"><label for="startingBalance">Starting Balance</label><input id="startingBalance" type="number" step="1" value="0"></div>
    </div>
    <div style="display:flex;gap:10px;margin-top:12px">
      <button class="btn primary" id="btnSaveSettings">Save</button>
      <button class="btn secondary" id="btnCloseSettings">Close</button>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    const sheet=document.getElementById('selectorSheet');
    const tabH=document.getElementById('tabHabits');
    const tabV=document.getElementById('tabVices');
    const listH=document.getElementById('listHabits');
    const listV=document.getElementById('listVices');
    const sheetTitle=document.getElementById('sheetTitle');
    function openSheet(type){
      sheet.classList.add('open'); sheet.setAttribute('aria-hidden','false');
      if(type==='habit'){ tabH.classList.add('active'); tabV.classList.remove('active'); listH.style.display='grid'; listV.style.display='none'; sheetTitle.textContent='Select Habit'; }
      else{ tabV.classList.add('active'); tabH.classList.remove('active'); listV.style.display='grid'; listH.style.display='none'; sheetTitle.textContent='Select Vice'; }
    }
    function closeSheet(){ sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); }
    document.getElementById('btnUp').addEventListener('click',()=>openSheet('habit'));
    document.getElementById('btnDown').addEventListener('click',()=>openSheet('vice'));
    tabH.addEventListener('click',()=>openSheet('habit'));
    tabV.addEventListener('click',()=>openSheet('vice'));
    document.getElementById('sheetCancel').addEventListener('click',closeSheet);
    document.getElementById('sheetApply').addEventListener('click',closeSheet);
    listH.addEventListener('click',e=>{const el=e.target.closest('.item'); if(!el) return; window.selectedChoice=el.dataset;});
    listV.addEventListener('click',e=>{const el=e.target.closest('.item'); if(!el) return; window.selectedChoice=el.dataset;});
    const manageSheet=document.getElementById('manageSheet');
    document.getElementById('btnManage').addEventListener('click',()=>{manageSheet.classList.add('open'); manageSheet.setAttribute('aria-hidden','false');});
    document.getElementById('btnCloseManage').addEventListener('click',()=>{manageSheet.classList.remove('open'); manageSheet.setAttribute('aria-hidden','true');});
    const settingsSheet=document.getElementById('settingsSheet');
    document.getElementById('btnSettings').addEventListener('click',()=>{settingsSheet.classList.add('open'); settingsSheet.setAttribute('aria-hidden','false');});
    document.getElementById('btnCloseSettings').addEventListener('click',()=>{settingsSheet.classList.remove('open'); settingsSheet.setAttribute('aria-hidden','true');});
  </script>
</body>
</html>