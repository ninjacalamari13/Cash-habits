<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Now Mode</title>
  <meta name="theme-color" content="#111" />

  <!-- Chart.js 2.x -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>

  <style>
    :root{
      --bg:#0f0f10; --panel:#161618; --text:#eee; --muted:#9aa0a6;
      --accent:#78ffd6;

      /* metrics */
      --sleep:#3aa3ff;   /* blue */
      --mood:#ffd44d;    /* yellow */
      --energy:#ffa04d;  /* orange */
      --focus:#ffffff;   /* white */

      /* stacks */
      --habit:#00ff64;   /* neon green */
      --vice:#ff3c3c;    /* neon red */
    }

    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, sans-serif;
      -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }

    .wrap{max-width:980px;margin:18px auto;padding:16px}
    .card{
      background:var(--panel);
      border:1px solid #212124;
      border-radius:16px;
      padding:16px;
      box-shadow:0 12px 34px rgba(0,0,0,.35);
    }
    h1{font-size:18px;margin:0 0 10px 0}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}

    /* ===== Tally Header ===== */
    .tally{
      display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .score{
      min-width:240px; flex:1; background:#101013; border:1px solid #1e1e22; border-radius:14px; padding:14px;
      position:relative; overflow:hidden;
      box-shadow: inset 0 0 30px rgba(0,0,0,.35);
    }
    .score .label{font-size:12px;color:var(--muted);margin-bottom:6px}
    .score .value{
      font-size:32px; font-weight:700; letter-spacing:.5px;
      text-shadow: 0 0 10px rgba(120,255,214,.6), 0 0 24px rgba(120,255,214,.35);
    }
    .bar{
      margin-top:10px; height:12px; border-radius:999px; background:#1a1a1d; position:relative;
      box-shadow: inset 0 0 10px rgba(0,0,0,.5);
    }
    .bar > .fill{
      width:50%; height:100%; border-radius:inherit;
      background: linear-gradient(90deg, #00ffa3, #00d2ff);
      box-shadow: 0 0 8px #00ffa3, 0 0 18px #00ffa3, 0 0 28px #00d2ff;
      transition: width .25s ease;
    }

    .actions{display:flex;gap:10px;align-items:center}
    .btn{
      appearance:none; -webkit-appearance:none; cursor:pointer;
      border:1px solid #232327; background:#121214; color:#fff;
      padding:10px 14px; border-radius:12px; font-weight:600;
      box-shadow:0 6px 18px rgba(0,0,0,.35);
      transition: transform .05s ease;
    }
    .btn:active{ transform: translateY(1px) }
    .btn.glow{
      border-color:#1f4136;
      background: radial-gradient(120% 120% at 10% 0%, rgba(0,255,163,.15), transparent 60%),
                  #121214;
      box-shadow:
        0 0 10px rgba(0,255,163,.45),
        0 0 24px rgba(0,210,255,.25),
        inset 0 0 12px rgba(0,255,163,.12);
    }
    .btn.red{
      border-color:#3a2020;
      background: radial-gradient(120% 120% at 10% 0%, rgba(255,60,60,.15), transparent 60%),
                  #121214;
      box-shadow:
        0 0 10px rgba(255,60,60,.45),
        0 0 24px rgba(255,60,60,.25),
        inset 0 0 12px rgba(255,60,60,.12);
    }

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:12px; background:#101012; border:1px solid #232327;
      font-size:13px; color:#fff;
    }
    .chip .dot{width:10px;height:10px;border-radius:50%}
    .chip.habit .dot{ background: var(--habit); box-shadow:0 0 8px var(--habit), 0 0 18px var(--habit) }
    .chip.vice  .dot{ background: var(--vice);  box-shadow:0 0 8px var(--vice),  0 0 18px var(--vice) }

    /* ===== Sliders ===== */
    .slider{flex:1;min-width:220px;display:flex;flex-direction:column;gap:6px}
    .slider label{font-size:12px;color:var(--muted)}
    .slider input[type=range]{ -webkit-appearance:none; width:100%; height:10px; background:#1f1f23;border-radius:8px; outline:none; }
    .slider input[type=range]::-webkit-slider-thumb{
      -webkit-appearance:none; width:22px;height:22px;border-radius:50%;
      background: currentColor; border:2px solid #fff;
      box-shadow: 0 0 8px currentColor, 0 0 18px currentColor, 0 0 28px currentColor;
      cursor:pointer; margin-top:-6px;
    }
    .slider input[type=range]::-moz-range-thumb{
      width:22px;height:22px;border-radius:50%; background: currentColor; border:2px solid #fff;
      box-shadow: 0 0 8px currentColor, 0 0 18px currentColor, 0 0 28px currentColor;
      cursor:pointer;
    }
    .slider.sleep  input{ color: var(--sleep); }
    .slider.mood   input{ color: var(--mood); }
    .slider.energy input{ color: var(--energy); }
    .slider.focus  input{ color: var(--focus); }

    /* ===== Canvas ===== */
    .canvas-wrap{
      background:#0c0c10;border:1px solid #202026;border-radius:16px;padding:10px;
      box-shadow: inset 0 0 30px rgba(0,0,0,.35);
    }
    canvas{ display:block; width:100% }

    /* ===== Modal (bottom sheet) ===== */
    .sheet{
      position:fixed; left:0; right:0; bottom:-100%;
      background:#131317; border-top-left-radius:16px;border-top-right-radius:16px;
      border-top:1px solid #24242a; padding:14px 16px 20px; z-index:50;
      box-shadow:0 -20px 40px rgba(0,0,0,.55);
      transition: bottom .25s ease;
    }
    .sheet.open{ bottom:0 }
    .sheet .grab{ width:44px;height:4px;border-radius:999px;background:#2a2a2f;margin:4px auto 12px}
    .sheet h2{ font-size:16px; margin:0 0 8px 0 }
    .tabbar{ display:flex; gap:8px; margin-bottom:8px }
    .tab{
      flex:1; text-align:center; padding:8px 10px; border-radius:10px; cursor:pointer;
      border:1px solid #232327; background:#0f0f12; font-weight:600;
    }
    .tab.active{ background:#131318; box-shadow: inset 0 0 18px rgba(0,0,0,.5) }

    .list{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; }
    .item{
      border:1px solid #232327; border-radius:12px; padding:10px; cursor:pointer;
      background:#0f0f12;
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      transition: transform .05s ease;
    }
    .item:active{ transform: translateY(1px) }
    .item .name{ font-size:14px }
    .item .meta{ font-size:12px; color:var(--muted) }
    .item.habit{ color: var(--habit) }
    .item.vice{  color: var(--vice)  }
    .item.habit .name, .item.vice .name{
      text-shadow:0 0 10px currentColor, 0 0 22px currentColor;
    }

    .sheet .footer{ display:flex; gap:10px; margin-top:12px }
    .btn.secondary{ background:#121214; border-color:#2a2a2f }
    .btn.primary{ background:#0f1311; border-color:#1f4136 }

    /* Utility */
    .spacer{height:12px}
    @media (max-width:560px){ .list{ grid-template-columns:1fr } }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- ===== Tally / Controls ===== -->
    <div class="card" style="margin-bottom:16px">
      <div class="tally">
        <div class="score">
          <div class="label">Dopamine / Mindfulness Tally</div>
          <div class="value" id="tallyValue">0</div>
          <div class="bar"><div class="fill" id="tallyFill" style="width:50%"></div></div>
        </div>

        <div class="actions">
          <button class="btn glow" id="btnUp"   aria-label="Add habit (open selector)">▲ Up</button>
          <button class="btn red"  id="btnDown" aria-label="Add vice (open selector)">▼ Down</button>
          <button class="btn" id="btnUndo" aria-label="Undo last action">⟲ Undo</button>
          <button class="btn" id="btnExport" aria-label="Export data">⇩ Export</button>
        </div>

        <div class="row">
          <div class="chip habit"><span class="dot"></span><span>Habits</span></div>
          <div class="chip vice"><span class="dot"></span><span>Vices</span></div>
        </div>
      </div>

      <div class="spacer"></div>

      <!-- Sliders -->
      <div class="row">
        <div class="slider sleep">
          <label for="sleepSlider">Sleep (hrs)</label>
          <input id="sleepSlider" type="range" min="0" max="12" value="7">
        </div>
        <div class="slider mood">
          <label for="moodSlider">Mood (0–10)</label>
          <input id="moodSlider" type="range" min="0" max="10" value="6">
        </div>
        <div class="slider energy">
          <label for="energySlider">Energy (0–10)</label>
          <input id="energySlider" type="range" min="0" max="10" value="6">
        </div>
        <div class="slider focus">
          <label for="focusSlider">Focus (0–10)</label>
          <input id="focusSlider" type="range" min="0" max="10" value="6">
        </div>
      </div>
    </div>

    <!-- ===== Trends ===== -->
    <div class="card">
      <h1>Trends</h1>
      <div class="canvas-wrap">
        <canvas id="trendChart" height="300"></canvas>
      </div>
    </div>
  </div>

  <!-- ===== Habit/Vice Selector (Bottom Sheet) ===== -->
  <div class="sheet" id="selectorSheet" aria-hidden="true">
    <div class="grab"></div>
    <h2 id="sheetTitle">Select Habit or Vice</h2>

    <div class="tabbar">
      <div class="tab active" id="tabHabits" role="button" aria-controls="listHabits">Habits</div>
      <div class="tab" id="tabVices" role="button" aria-controls="listVices">Vices</div>
    </div>

    <div class="list" id="listHabits">
      <!-- Default Habits with data attributes for points/cash -->
      <div class="item habit" data-type="habit" data-name="Meditation" data-points="1" data-cash="1"><span class="name">Meditation</span><span class="meta">+1 pt • +$1</span></div>
      <div class="item habit" data-type="habit" data-name="Learning"   data-points="1" data-cash="1"><span class="name">Learning</span><span class="meta">+1 pt • +$1</span></div>
      <div class="item habit" data-type="habit" data-name="Journal"    data-points="1" data-cash="1"><span class="name">Journal</span><span class="meta">+1 pt • +$1</span></div>
      <div class="item habit" data-type="habit" data-name="Fitness"    data-points="2" data-cash="2"><span class="name">Fitness</span><span class="meta">+2 pt • +$2</span></div>
      <div class="item habit" data-type="habit" data-name="Music"      data-points="1" data-cash="1"><span class="name">Music</span><span class="meta">+1 pt • +$1</span></div>
      <div class="item habit" data-type="habit" data-name="Cooking"    data-points="1" data-cash="1"><span class="name">Cooking</span><span class="meta">+1 pt • +$1</span></div>
      <div class="item habit" data-type="habit" data-name="Sleep ≥ 8h" data-points="2" data-cash="2"><span class="name">Sleep ≥ 8h</span><span class="meta">+2 pt • +$2</span></div>
    </div>

    <div class="list" id="listVices" style="display:none">
      <!-- Default Vices -->
      <div class="item vice" data-type="vice" data-name="Weed"         data-points="-1" data-cash="-1"><span class="name">Weed</span><span class="meta">-1 pt • -$1</span></div>
      <div class="item vice" data-type="vice" data-name="Alcohol"      data-points="-2" data-cash="-2"><span class="name">Alcohol</span><span class="meta">-2 pt • -$2</span></div>
      <div class="item vice" data-type="vice" data-name="Nicotine"     data-points="-2" data-cash="-2"><span class="name">Nicotine</span><span class="meta">-2 pt • -$2</span></div>
      <div class="item vice" data-type="vice" data-name="Doomscrolling" data-points="-1" data-cash="-1"><span class="name">Doomscrolling</span><span class="meta">-1 pt • -$1</span></div>
      <div class="item vice" data-type="vice" data-name="Wank"         data-points="-1" data-cash="-1"><span class="name">Wank</span><span class="meta">-1 pt • -$1</span></div>
      <div class="item vice" data-type="vice" data-name="Sleep < 6h"   data-points="-2" data-cash="-2"><span class="name">Sleep &lt; 6h</span><span class="meta">-2 pt • -$2</span></div>
    </div>

    <div class="footer">
      <button class="btn secondary" id="sheetCancel">Cancel</button>
      <button class="btn primary" id="sheetApply">Apply</button>
    </div>
  </div>

  <!-- Hook up behavior in your app.js -->
  <script src="app.js"></script>
  <script>
    /* Minimal sheet tab toggles (keep logic simple; replace with app.js if you want) */
    const sheet = document.getElementById('selectorSheet');
    const tabH  = document.getElementById('tabHabits');
    const tabV  = document.getElementById('tabVices');
    const listH = document.getElementById('listHabits');
    const listV = document.getElementById('listVices');
    const btnUp = document.getElementById('btnUp');
    const btnDown = document.getElementById('btnDown');
    const sheetTitle = document.getElementById('sheetTitle');

    function openSheet(type){
      sheet.classList.add('open');
      sheet.setAttribute('aria-hidden','false');
      if(type==='habit'){
        tabH.classList.add('active'); tabV.classList.remove('active');
        listH.style.display='grid';    listV.style.display='none';
        sheetTitle.textContent = 'Select Habit';
      }else{
        tabV.classList.add('active'); tabH.classList.remove('active');
        listV.style.display='grid';    listH.style.display='none';
        sheetTitle.textContent = 'Select Vice';
      }
    }
    function closeSheet(){
      sheet.classList.remove('open');
      sheet.setAttribute('aria-hidden','true');
    }
    tabH.addEventListener('click', ()=>openSheet('habit'));
    tabV.addEventListener('click', ()=>openSheet('vice'));
    btnUp.addEventListener('click', ()=>openSheet('habit'));
    btnDown.addEventListener('click', ()=>openSheet('vice'));
    document.getElementById('sheetCancel').addEventListener('click', closeSheet);
    document.getElementById('sheetApply').addEventListener('click', closeSheet);

    // Optional: let app.js capture clicks on .item via event delegation
    document.getElementById('listHabits').addEventListener('click', e=>{
      const el = e.target.closest('.item'); if(!el) return;
      window.selectedChoice = el.dataset; // {type,name,points,cash}
    });
    document.getElementById('listVices').addEventListener('click', e=>{
      const el = e.target.closest('.item'); if(!el) return;
      window.selectedChoice = el.dataset;
    });
  </script>
</body>
</html>
